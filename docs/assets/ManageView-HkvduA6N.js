import{d as x,i as b,o as u,k as p,n as k,e as m,b as e,h as L,t as D,T as q,m as M,U as Q,g as B,F as H,l as F,V as G,W as j,X as A,I as R,Y,J,a as T,v as C,D as W,E as N,G as X,H as Z,s as K,S as ee,r as se,O as V,Z as z,f as E,L as te,x as I,R as P,_ as oe,B as O,$ as ne,A as ae}from"./index-_Vq3MwQz.js";async function re(g){const t=window.crypto.subtle,s="SHA-256",n=await le(g),l=await t.digest(s,n);return ie(l)}function le(g){return new Promise((t,s)=>{const n=new FileReader;n.readAsArrayBuffer(g),n.onload=()=>t(n.result),n.onerror=l=>s(l)})}function ie(g){return Array.from(new Uint8Array(g)).map(t=>t.toString(16).padStart(2,"0")).join("")}const de=e("h5",null,[L(" Drop your files here "),e("pre",null,"(max size 10 MB)")],-1),ue=[de],ce=x({__name:"UploadDropbox",emits:["upload"],setup(g,{emit:t}){const s=t,n=b(!1);function l({dataTransfer:f}){if(n.value=!1,!f)return;const r=[...f.files];s("upload",r)}return(f,r)=>(u(),p("div",{class:k(["w-full px-10 py-20 rounded text-center cursor-pointer border border-dashed border-gray-400 text-gray-400 transition duration-500 hover:text-white hover:bg-green-400 hover:border-green-400 hover:border-solid",{"bg-green-400 border-green-400 border-solid":n.value}]),onDrag:r[0]||(r[0]=m(()=>{},["prevent","stop"])),onDragstart:r[1]||(r[1]=m(()=>{},["prevent","stop"])),onDragend:r[2]||(r[2]=m(o=>n.value=!1,["prevent","stop"])),onDragover:r[3]||(r[3]=m(o=>n.value=!0,["prevent","stop"])),onDragenter:r[4]||(r[4]=m(o=>n.value=!0,["prevent","stop"])),onDragleave:r[5]||(r[5]=m(o=>n.value=!1,["prevent","stop"])),onDrop:r[6]||(r[6]=m(o=>l(o),["prevent","stop"]))},ue,34))}}),ge={class:"mb-4"},pe={class:"flex h-4 overflow-hidden bg-gray-200 rounded"},me={key:0,class:"text-red-600 text-xs"},fe=x({__name:"ProgressBar",props:{upload:{}},setup(g){return(t,s)=>(u(),p("div",ge,[e("div",{class:k(["font-bold text-sm",t.upload.text_class])},[e("i",{class:k(t.upload.icon)},null,2),L(" "+D(t.upload.name),1)],2),e("div",pe,[e("div",{class:k(["transition-all progress-bar bg-blue-400",t.upload.variant]),style:q({width:`${t.upload.progress}%`})},null,6)]),t.upload.errorMessage?(u(),p("div",me,D(t.upload.errorMessage),1)):M("",!0)]))}}),ve={class:"bg-white rounded border border-gray-200 relative flex flex-col"},be=e("div",{class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},[e("span",{class:"card-title"},"Upload"),e("i",{class:"fas fa-upload float-right text-green-400 text-2xl"})],-1),_e={class:"p-6"},he=e("hr",{class:"my-6"},null,-1),ye=x({__name:"UploadSongs",props:{userSongs:{}},emits:["songAdded"],setup(g,{emit:t}){const s=t,n=g,l=b([]);function f(o){o.forEach(async a=>{if(a.type!=="audio/mpeg")return;const i=await re(a);if(n.userSongs.find(c=>c.hash===i)){l.value.push({name:a.name,progress:100,variant:"bg-red-400",icon:"fas fa-times",text_class:"text-red-400",errorMessage:"Such a file already exists"});return}const _=G(j,`songs/${i}`),U=await A(_).then(()=>!0).catch(()=>!1),y={uid:R.currentUser.uid,display_name:R.currentUser.displayName,original_name:a.name,modified_name:a.name,genre:"",comment_count:0,url:"",hash:i},v=l.value.push({name:a.name,progress:0,variant:"bg-blue-400",icon:"fas fa-spinner fa-spin",text_class:""})-1;if(U){l.value[v].progress=100,y.url=await A(_),await r(y,v);return}const $=Y(_,a);l.value[v].task=$,$.on("state_changed",c=>{const d=c.bytesTransferred/c.totalBytes*100;l.value[v].progress=d},c=>{const d=l.value[v];d.variant="bg-red-400",d.icon="fas fa-times",d.text_class="text-red-400",d.errorMessage="The file size must be less than 10 MB",console.log(c)},async()=>{y.url=await A($.snapshot.ref),await r(y,v)})})}async function r(o,a){await J(C,o);const i=l.value[a];i.variant="bg-green-400",i.icon="fas fa-check",i.text_class="text-green-400",s("songAdded")}return Q(()=>{l.value.forEach(o=>{var a;o&&((a=o.task)==null||a.cancel())})}),(o,a)=>(u(),p("div",ve,[be,e("div",_e,[B(ce,{onUpload:f}),e("input",{type:"file",multiple:"",onChange:a[0]||(a[0]=i=>f([...i.target.files]))},null,32),he,(u(!0),p(H,null,F(l.value,i=>(u(),T(fe,{key:i.name,upload:i},null,8,["upload"]))),128))])]))}}),xe={class:"fixed z-10 inset-0 overflow-y-auto",id:"modal"},$e={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},we={class:"fixed inset-0 transition-opacity"},Se=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen"},"â€‹",-1),ke={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Be={class:"py-4 text-left px-6"},De={class:"flex justify-between items-center pb-4"},Ue=e("p",{class:"text-xl font-bold"},"Are you sure you want to delete it?",-1),Ce=e("i",{class:"fas fa-times"},null,-1),Ae=[Ce],Ee={class:"mt-4"},Me={key:0,class:"text-center text-2xl"},Re=e("i",{class:"fas fa-spinner fa-spin"},null,-1),He=[Re],Te={key:1},Ne={class:"mt-4"},Ve=["disabled"],ze=["disabled"],Le=x({__name:"DeleteConfirmDialog",props:{text:{},loading:{type:Boolean}},emits:["close","confirm"],setup(g){return(t,s)=>(u(),p("div",xe,[e("div",$e,[e("div",we,[e("div",{class:"absolute inset-0 bg-gray-800 opacity-75",onClick:s[0]||(s[0]=m(n=>t.$emit("close"),["prevent"]))})]),Se,e("div",ke,[e("div",Be,[e("div",De,[Ue,e("div",{class:"modal-close cursor-pointer z-50",onClick:s[1]||(s[1]=m(n=>t.$emit("close"),["prevent"]))},Ae)]),e("div",Ee,[t.loading?(u(),p("div",Me,He)):(u(),p("div",Te,D(t.text),1)),e("div",Ne,[e("button",{type:"button",class:"py-1.5 px-3 rounded text-white bg-gray-600 mr-4",disabled:t.loading,onClick:s[2]||(s[2]=m(n=>t.$emit("close"),["stop"]))}," No ",8,Ve),e("button",{type:"button",class:"py-1.5 px-3 rounded text-white bg-red-600",disabled:t.loading,onClick:s[3]||(s[3]=m(n=>t.$emit("confirm"),["stop"]))}," Yes ",8,ze)])])])])])]))}}),Fe={class:"border border-gray-200 p-3 mb-4 rounded"},Ge={class:"inline-block text-2xl font-bold"},je=e("i",{class:"fas fa-trash"},null,-1),Ie=[je],Pe=e("i",{class:"fa fa-pencil-alt"},null,-1),Oe=[Pe],qe={class:"mb-3"},Qe=e("label",{class:"inline-block mb-2"},"Song Title",-1),Ye={class:"mb-3"},Je=e("label",{class:"inline-block mb-2"},"Genre",-1),We=["disabled"],Xe=["disabled"],Ze=x({__name:"UserSongItem",props:{song:{}},emits:["updateSong","removeSong"],setup(g,{emit:t}){const s=g,n=t,l=b(!1),f=W({title:N().required(),genre:N()}),{handleSubmit:r}=X({validationSchema:Z(f),initialValues:{title:s.song.modified_name,genre:s.song.genre}}),o=b(!1),a=b(!1),i=b("bg-blue-500"),h=b("Please wait! Updating song info."),_=K(C,s.song.id),U=r(async c=>{a.value=!0,o.value=!0,i.value="bg-blue-500",h.value="Please wait! Updating song info.";try{await ee(_,{modified_name:c.title,genre:c.genre})}catch{o.value=!1,i.value="bg-red-500",h.value="Something went wrong! Try again later.";return}n("updateSong",c),o.value=!1,i.value="bg-green-500",h.value="Success! Song updated.",l.value=!1}),y=b(!1),v=b(!1);async function $(){const c=I(C,P("hash","==",s.song.hash)),d=G(j,`songs/${s.song.hash}`);try{v.value=!0,await oe(_),(await O(c)).docs.length===0&&await ne(d),n("removeSong")}catch(w){console.error(w)}finally{v.value=!1}}return(c,d)=>{const w=se("vee-field");return u(),p(H,null,[e("div",Fe,[V(e("div",null,[e("h4",Ge,D(c.song.modified_name),1),e("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-red-600 float-right",onClick:d[0]||(d[0]=S=>y.value=!0)},Ie),e("button",{class:"ml-1 py-1 px-2 text-sm rounded text-white bg-blue-600 float-right",onClick:d[1]||(d[1]=S=>l.value=!0)},Oe)],512),[[z,!l.value]]),V(e("div",null,[a.value?(u(),p("div",{key:0,class:k(["text-white text-center font-bold p-4 rounded mb-4",i.value])},D(h.value),3)):M("",!0),e("form",{onSubmit:d[3]||(d[3]=(...S)=>E(U)&&E(U)(...S))},[e("div",qe,[Qe,B(w,{name:"title",type:"text",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Song Title"}),B(E(te),{class:"text-red-600",name:"title"})]),e("div",Ye,[Je,B(w,{name:"genre",type:"text",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Enter Genre"})]),e("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 mr-4",disabled:o.value}," Submit ",8,We),e("button",{type:"button",class:"py-1.5 px-3 rounded text-white bg-gray-600",disabled:o.value,onClick:d[2]||(d[2]=m(S=>l.value=!1,["stop"]))}," Go Back ",8,Xe)],32)],512),[[z,l.value]])]),y.value?(u(),T(Le,{key:0,text:s.song.modified_name,loading:v.value,onClose:d[4]||(d[4]=S=>y.value=!1),onConfirm:$},null,8,["text","loading"])):M("",!0)],64)}}}),Ke={class:"container mx-auto mt-6"},es={class:"md:grid md:grid-cols-3 md:gap-4"},ss={class:"col-span-1"},ts={class:"col-span-2"},os={class:"bg-white rounded border border-gray-200 relative flex flex-col"},ns=e("div",{class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},[e("span",{class:"card-title"},"My Songs"),e("i",{class:"fa fa-compact-disc float-right text-green-400 text-2xl"})],-1),as={class:"p-6"},rs={key:0,class:"text-center text-gray-500"},is=x({__name:"ManageView",setup(g){var r;const t=I(C,P("uid","==",(r=R.currentUser)==null?void 0:r.uid),ae("modified_name")),s=b([]);async function n(){const o=await O(t);s.value=o.docs.map(a=>({...a.data(),id:a.id}))}n();function l(o,a){const i=s.value[o];i.modified_name=a.title,i.genre=a.genre??""}function f(o){s.value.splice(o,1)}return(o,a)=>(u(),p("section",Ke,[e("div",es,[e("div",ss,[B(ye,{userSongs:s.value,onSongAdded:n},null,8,["userSongs"])]),e("div",ts,[e("div",os,[ns,e("div",as,[s.value.length===0?(u(),p("div",rs,"List empty")):(u(!0),p(H,{key:1},F(s.value,(i,h)=>(u(),T(Ze,{key:i.id,song:i,onUpdateSong:_=>l(h,_),onRemoveSong:_=>f(h)},null,8,["song","onUpdateSong","onRemoveSong"]))),128))])])])])]))}});export{is as default};
