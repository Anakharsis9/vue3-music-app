import{d as S,C as N,D as U,E as V,G as z,H as E,i,I as B,J as R,K as F,r as Y,o as u,k as x,n as L,t as d,m as M,b as e,g as $,f as v,L as O,F as T,M as Q,c as A,N as G,u as H,e as J,a as q,O as K,P as j,l as W,Q as X,q as Z,s as P,x as ee,R as te,B as se,v as I,S as oe}from"./index-TiDwsDXq.js";const ae={class:"mb-4"},ne=["disabled"],re=S({__name:"CommentForm",emits:["addComment"],setup(k,{emit:n}){const g=n,r=N(),f=U({comment_text:V().min(3).required()}),{handleSubmit:s}=z({validationSchema:E(f)}),m=i(!1),_=i(!1),l=i("bg-blue-500"),b=i("Please wait! Your comment is being submitted"),c=s(async(w,{resetForm:o})=>{_.value=!0,m.value=!0,l.value="bg-blue-500",b.value="Please wait! Your comment is being submitted";const h={content:w.comment_text,date_posted:new Date().toString(),song_id:r.params.id,author:{name:B.currentUser.displayName??"",uid:B.currentUser.uid}};try{await R(F,h)}catch{m.value=!1,l.value="bg-red-500",b.value="Invalid login details.";return}g("addComment"),m.value=!1,l.value="bg-green-500",b.value="Success! Comment added!",o(),setTimeout(()=>{_.value=!1},2e3)});return(w,o)=>{const h=Y("vee-field");return u(),x(T,null,[_.value?(u(),x("div",{key:0,class:L(["text-white text-center font-bold p-4 rounded mb-4",l.value])},d(b.value),3)):M("",!0),e("form",{onSubmit:o[0]||(o[0]=(...t)=>v(c)&&v(c)(...t))},[e("div",ae,[$(h,{as:"textarea",name:"comment_text",class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded",placeholder:"Your comment here..."}),$(v(O),{class:"text-red-600 mb-4",name:"comment_text"})]),e("button",{type:"submit",class:"py-1.5 px-3 rounded text-white bg-green-600 block",disabled:m.value}," Submit ",8,ne)],32)],64)}}}),le={class:"p-6 bg-gray-50 border border-gray-200"},ce={class:"mb-5"},ie={class:"font-bold"},ue=S({__name:"CommentItem",props:{comment:{}},setup(k){return(n,g)=>(u(),x("li",le,[e("div",ce,[e("div",ie,d(n.comment.author.name),1),e("time",null,d(n.comment.date_posted),1)]),e("p",null,d(n.comment.content),1)]))}}),de={class:"w-full mb-8 py-14 text-center text-white relative"},me=e("div",{class:"absolute inset-0 w-full h-full box-border bg-contain music-bg",style:{"background-image":"url(/assets/img/song-header.png)"}},null,-1),_e={class:"container mx-auto flex items-center"},be={class:"z-50 text-left ml-8"},pe={class:"text-3xl font-bold"},ve={id:"comments",class:"container mx-auto mt-6"},ge={class:"bg-white rounded border border-gray-200 relative flex flex-col"},fe={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},he={class:"card-title"},ye=e("i",{class:"fa fa-comments float-right text-green-400 text-2xl"},null,-1),xe={class:"p-6"},we=e("option",{value:"latest"},"Latest",-1),Ce=e("option",{value:"oldest"},"Oldest",-1),Se=[we,Ce],ke={class:"container mx-auto"},Be=S({__name:"SongView",setup(k){const n=Q(),g=X(),r=N(),f=r.params.id,s=i(null);async function m(){const t=await Z(P(I,f));if(!t.exists()){g.push({name:"home"});return}s.value={...t.data(),id:t.id}}m();const _=i([]);async function l(){const t=ee(F,te("song_id","==",f)),p=await se(t);_.value=p.docs.map(a=>({...a.data(),id:a.id}))}l();async function b(){s.value&&(s.value.comment_count+=1,await oe(P(I,f),{comment_count:s.value.comment_count}),l())}const c=i(r.query.sortBy?r.query.sortBy:"latest"),w=A(()=>_.value.slice().sort((t,p)=>{const a=new Date(t.date_posted).getTime(),y=new Date(p.date_posted).getTime();return c.value==="latest"?y-a:a-y}));G(c,t=>{t!==r.query.sortBy&&g.replace({...r,query:{sortBy:t}})},{immediate:!0});const o=H();function h(){s.value&&o.newSong(s.value)}return(t,p)=>{var a,y,D;return u(),x("main",null,[e("section",de,[me,e("div",_e,[e("button",{type:"button",class:"z-50 h-24 w-24 text-3xl bg-white text-black rounded-full focus:outline-none",onClick:J(h,["prevent"])},[e("i",{class:L(["fas",{"fa-play":!v(o).isPlaying,"fa-pause":v(o).isPlaying}])},null,2)]),e("div",be,[e("div",pe,d((a=s.value)==null?void 0:a.modified_name),1),e("div",null,d((y=s.value)==null?void 0:y.genre),1)])])]),e("section",ve,[e("div",ge,[e("div",fe,[e("span",he,"Comments ("+d((D=s.value)==null?void 0:D.comment_count)+")",1),ye]),e("div",xe,[v(n).userLoggedIn?(u(),q(re,{key:0,onAddComment:b})):M("",!0),K(e("select",{class:"block mt-4 py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded","onUpdate:modelValue":p[0]||(p[0]=C=>c.value=C)},Se,512),[[j,c.value]])])])]),e("ul",ke,[(u(!0),x(T,null,W(w.value,C=>(u(),q(ue,{key:C.id,comment:C},null,8,["comment"]))),128))])])}}});export{Be as default};
